import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.pipeline import make_pipeline
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import accuracy_score,confusion_matrix
import random
import matplotlib.pyplot as plt
from util.tools import np_bit_loss,npflip,np_bit_aug
from data.loadData import loadData
from util.tools import accConfusion,binariz

from sklearn.linear_model import LogisticRegression

# names = ['bbheader_gseheader']
# names = ['gseheader']
names = ['ipheaders']

name = names[0]

X,y,_ = loadData(name)
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=42)

lg = LogisticRegression()
lg.fit(X_train, y_train)
y_pred_test = lg.predict(X_test)
acc, tn, fp, fn, tp = accConfusion(y_test, y_pred_test)

print('ACC',acc)
print('TN',tn,'FP',fp,'FN',fn, 'TP',tp)


for percentage in range(2,22,2):
    rate = percentage/100
    accs= []
    pres= []
    recalls= []
    f1s = []
    for i in range(10):
        X_test_crpt = np.array([np_bit_aug(x,rate) for x in X_test])
        y_pred_test_crpt = lg.predict(X_test_crpt)
        acc, tn, fp, fn, tp = accConfusion(y_test, y_pred_test_crpt)
        pre = tp/(tp+fp)
        rec = tp/(tp+fn)
        accs.append(acc)
        pres.append(pre)
        recalls.append(rec)
        f1s.append(2*pre*rec/(pre+rec))

    print('after Corruption')
    print('rate',rate)
    print((np.mean(accs), np.std(accs)),
          (np.mean(pres), np.std(pres)),
          (np.mean(recalls), np.std(recalls)),
          (np.mean(f1s), np.std(f1s)))

""""
bbheader_gseheader
after Corruption
rate 0.02
(0.9658140338748705, 0.0016609766715152377) (0.9696164954450657, 0.002167906982109061) (0.9629503738953094, 0.0037389530931339265) (0.9662651537407706, 0.0016898474645080212)
after Corruption
rate 0.04
(0.9482889733840304, 0.0030614019807099417) (0.9676562669102916, 0.0026250074762537933) (0.9293677770224337, 0.0049439504651466295) (0.9481190015737753, 0.0031535089875722993)
after Corruption
rate 0.06
(0.929830625648116, 0.004110326027292017) (0.9676264442545245, 0.003102869869931998) (0.891842284160435, 0.007305661031901094) (0.9281741176546747, 0.004406931300167775)
after Corruption
rate 0.08
(0.9090217767023849, 0.005700383608627175) (0.9634675676563598, 0.0041017613637074485) (0.8534330387491502, 0.009484258342132047) (0.9050952741987567, 0.006289065608499413)
after Corruption
rate 0.1
(0.8903560318008987, 0.0036964823740877548) (0.9639836919409166, 0.0037014398788887634) (0.8148198504418763, 0.006710516752822883) (0.8831296443219874, 0.004251997261892212)
after Corruption
rate 0.12
(0.8692706533010714, 0.005475878699844552) (0.9603867514099937, 0.003940524851820604) (0.7748470428280082, 0.008778761907468619) (0.8576787037798734, 0.00645843430850644)
after Corruption
rate 0.14
(0.8491185620463186, 0.004834944491757634) (0.9582006069039413, 0.004239665000113265) (0.7353501019714481, 0.008795854272615446) (0.8320832019921957, 0.00605872054346118)
after Corruption
rate 0.16
(0.8285862426546837, 0.005718485590997118) (0.9563942562783353, 0.003144175873184836) (0.6945615227736234, 0.011743404317440037) (0.8046552212451215, 0.007855598339015073)
after Corruption
rate 0.18
(0.8078119599032145, 0.007058616611359199) (0.9526717090535698, 0.004395985814245273) (0.6545207341944255, 0.012307371293143016) (0.7758907672738211, 0.009593845587604644)
after Corruption
rate 0.2
(0.7846526097476667, 0.006341742765884815) (0.9498938629678234, 0.005111388231013206) (0.6085656016315432, 0.010876104657490183) (0.7418079045153828, 0.009027444798347465)
"""
"""
gseheader
after Corruption
rate 0.02
(0.6845527351703543, 0.0029766803681185333) (0.7042916392518466, 0.003380571346810734) (0.6498123324396783, 0.0037395379676488155) (0.6759516127680134, 0.0031455112833293263)
after Corruption
rate 0.04
(0.6781050631193158, 0.002362975989899694) (0.7015007753427673, 0.002389935928849892) (0.6340214477211796, 0.003639502761253565) (0.6660529186950657, 0.0027955747074370997)
after Corruption
rate 0.06
(0.6734220171032985, 0.002885530675399521) (0.701603210945907, 0.0040040996500981495) (0.6177479892761395, 0.004855138318322743) (0.6569952230504292, 0.0032450451889346915)
after Corruption
rate 0.08
(0.6682910275553142, 0.002060440093546482) (0.7004023237251062, 0.002928078294961155) (0.6026541554959784, 0.003585784620775778) (0.647853175716554, 0.0023798068838554232)
after Corruption
rate 0.1
(0.6607031356047237, 0.004127135185881315) (0.6973229436824543, 0.0056515031665914225) (0.5829222520107238, 0.00463899942641249) (0.6349983652611184, 0.00421685238544799)
after Corruption
rate 0.12
(0.654866295642731, 0.003558471932936649) (0.6963486575113448, 0.004473094023446641) (0.5645040214477212, 0.004269726338148726) (0.6235277228373979, 0.004021636290687041)
after Corruption
rate 0.14
(0.6488122709379666, 0.0033852485254305593) (0.6933878889130555, 0.0036239535869704584) (0.5492493297587132, 0.0057300573597530305) (0.6129490969384184, 0.004612290312086247)
after Corruption
rate 0.16
(0.6409664721053345, 0.0042167027465750155) (0.692313237481966, 0.005927739270370605) (0.5236193029490617, 0.004920794494705899) (0.5962539908421494, 0.004786932879938494)
after Corruption
rate 0.18
(0.6346409664721053, 0.0027613761074958935) (0.6895037574818345, 0.0026143129605672027) (0.5064343163538874, 0.005219282127059461) (0.5839495799867799, 0.004291950010939952)
after Corruption
rate 0.2
(0.6275010180534817, 0.0034150531165503275) (0.6861930907207066, 0.004836157536527943) (0.4870241286863271, 0.005051609957453671) (0.5696905894706599, 0.004498394340448405)
"""

"""
ipheaders

after Corruption
rate 0.02
(0.9796852122986822, 0.0013720106013170835) (0.9808060769958373, 0.0013226651807875228) (0.9787327021121632, 0.0024112083550250477) (0.9797663751318698, 0.0013801358815048574)
after Corruption
rate 0.04
(0.9744875549048315, 0.0017015577304786888) (0.9835997923779413, 0.0016991295768103872) (0.965331391114348, 0.0020393299344501157) (0.9743793485396959, 0.0017133848061524524)
after Corruption
rate 0.06
(0.9651537335285505, 0.0021267699921426026) (0.9825590408537602, 0.0019591794339656374) (0.9474872541879098, 0.004363311231099844) (0.9646973049654128, 0.002221607684861644)
after Corruption
rate 0.08
(0.9541361639824306, 0.004557211274222483) (0.9838714990736932, 0.0019012147706535254) (0.9238892935178441, 0.009086654709145495) (0.9529131683320664, 0.004903779796542339)
after Corruption
rate 0.1
(0.9419838945827232, 0.0032585091169042494) (0.9828529831074558, 0.005116020349556984) (0.9002913328477785, 0.004611556043197885) (0.9397494749050528, 0.0033841062404804142)
after Corruption
rate 0.12
(0.924267935578331, 0.005335664983860765) (0.9830246362436714, 0.0034133367758743915) (0.8642388929351785, 0.009992759147060448) (0.9197813135563917, 0.006002186406089785)
after Corruption
rate 0.14
(0.906185944363104, 0.004808972363695255) (0.9847369306463023, 0.002863627289476853) (0.8261471230881282, 0.00998133930243767) (0.8984597196381741, 0.005762926606675116)
after Corruption
rate 0.16
(0.8876647144948755, 0.004648609077598826) (0.9850093667848026, 0.0032998510509599276) (0.7884923525127457, 0.009712794218889816) (0.875823255851879, 0.005791385129849443)
after Corruption
rate 0.18
(0.8639824304538799, 0.004435488860820233) (0.9828464615989176, 0.002831253577951257) (0.7423160961398397, 0.008924966457124775) (0.8457802952925728, 0.005789877932926297)
after Corruption
rate 0.2
(0.8405929721815519, 0.006195034342930388) (0.9837162861899612, 0.004287326195355296) (0.6943190094683176, 0.012157039083219452) (0.8139976652658649, 0.00848773007403143)

"""