import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.pipeline import make_pipeline
from sklearn.preprocessing import StandardScaler
from sklearn.svm import SVC
from sklearn.metrics import accuracy_score,confusion_matrix
import random
import matplotlib.pyplot as plt
from util.tools import np_bit_loss,npflip,np_bit_aug
from data.loadData import loadData
from util.tools import accConfusion,binariz
from xgboost import XGBClassifier

# names = ['bbheader_gseheader']
# names = ['gseheader']
names = ['ipheaders']

name = names[0]

X,y,_ = loadData(name)
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=42)

xgb = XGBClassifier(n_estimators=2, max_depth=3, learning_rate=1, objective='binary:logistic')
xgb.fit(X_train, y_train)
y_pred_test = xgb.predict(X_test)
acc, tn, fp, fn, tp = accConfusion(y_test, y_pred_test)

print('ACC',acc)
print('TN',tn,'FP',fp,'FN',fn, 'TP',tp)

for percentage in range(2,22,2):
    rate = percentage/100
    accs= []
    pres= []
    recalls= []
    f1s = []
    for i in range(10):
        X_test_crpt = np.array([np_bit_aug(x,rate) for x in X_test])
        y_pred_test_crpt = xgb.predict(X_test_crpt)
        acc, tn, fp, fn, tp = accConfusion(y_test, y_pred_test_crpt)
        pre = tp/(tp+fp)
        rec = tp/(tp+fn)
        accs.append(acc)
        pres.append(pre)
        recalls.append(rec)
        f1s.append(2*pre*rec/(pre+rec))

    print('after Corruption')
    print('rate',rate)
    print((np.mean(accs), np.std(accs)),
          (np.mean(pres), np.std(pres)),
          (np.mean(recalls), np.std(recalls)),
          (np.mean(f1s), np.std(f1s)))
"""
bbheader_gseheader

after Corruption
rate 0.02
(0.9253715865883165, 0.002289994064991614) (0.90758441100498, 0.001907029932754282) (0.949966009517335, 0.004642656989521111) (0.9282846438419071, 0.002330382518243975)
after Corruption
rate 0.04
(0.9034220532319391, 0.004004907945512673) (0.9038791245790885, 0.002516136988035421) (0.9064581917063222, 0.007466773741806113) (0.9051524124521608, 0.004219700494302621)
after Corruption
rate 0.06
(0.8797787763567232, 0.004706082938159019) (0.9007338691219198, 0.003125851271649045) (0.8581237253569001, 0.007441043807464857) (0.8789028055778362, 0.005065687004624196)
after Corruption
rate 0.08
(0.8562737642585552, 0.004442260304574443) (0.8974810752473422, 0.003280557072837015) (0.8098572399728076, 0.009201569582826514) (0.8513901827072203, 0.0052828777040709275)
after Corruption
rate 0.1
(0.8417559626685103, 0.0025949981858448975) (0.894769306214051, 0.0046237303222949905) (0.7806254248810334, 0.005387679143732032) (0.8337878088683166, 0.002936107753932843)
after Corruption
rate 0.12
(0.8166954718285517, 0.0077416700779265836) (0.8876890066776435, 0.0060498347406156075) (0.7320870156356221, 0.011799936928528517) (0.8023883506656222, 0.009181997422993192)
after Corruption
rate 0.14
(0.8027652955409609, 0.004849625968142572) (0.887928307598151, 0.005448055553794823) (0.7005438477226378, 0.008854504423967001) (0.7831489923846275, 0.006122309232445811)
after Corruption
rate 0.16
(0.782544071897684, 0.007794581001187053) (0.8787615670483818, 0.005924342775821594) (0.6639021074099253, 0.013732154996600932) (0.7563107250869534, 0.010307269892643198)
after Corruption
rate 0.18
(0.7597649498790183, 0.00901906132446618) (0.8745939084438457, 0.0074752272855944085) (0.6157715839564921, 0.01502302430273786) (0.7226444043241989, 0.012345114055711811)
after Corruption
rate 0.2
(0.7478396128586242, 0.008769532726456229) (0.8727851666045506, 0.005509753001986139) (0.5900747790618628, 0.01806810778015522) (0.7039663419949074, 0.013460914181697021)

"""

"""
gseheader
after Corruption
rate 0.02
(0.6820008144427854, 0.0024350568101952083) (0.7080244451633296, 0.0027297156502695606) (0.6329490616621986, 0.003136729222520108) (0.6683825146654225, 0.0026722727801690607)
after Corruption
rate 0.04
(0.6685353603909325, 0.003271007227478814) (0.7014771443307201, 0.003758492933745049) (0.6011796246648793, 0.004551644059990162) (0.6474608783342635, 0.003793537381070918)
after Corruption
rate 0.06
(0.6557621827066649, 0.0035676767207274735) (0.6940555658433457, 0.00448702578727216) (0.5724664879356569, 0.004652922953633435) (0.6274162822360859, 0.004059841495340352)
after Corruption
rate 0.08
(0.6440070585041401, 0.0021196385281328366) (0.6867896720656057, 0.002703555277194698) (0.5458176943699733, 0.0041245932149760025) (0.6082331534780355, 0.0029655417493753195)
after Corruption
rate 0.1
(0.6328627663906611, 0.004546819291287419) (0.6778800562531443, 0.004346885179847212) (0.5236997319034851, 0.008341378335097599) (0.5908804439823161, 0.0067638760521958104)
after Corruption
rate 0.12
(0.6253427446721868, 0.004316653475472298) (0.6755329391328927, 0.005418989849396381) (0.5003485254691689, 0.006484445031788182) (0.5748773577031645, 0.005746162763042951)
after Corruption
rate 0.14
(0.6127188814985747, 0.004768896921385744) (0.6646687351779821, 0.00648068784709506) (0.47450402144772125, 0.008257590262095592) (0.5536790848684301, 0.006857360806473862)
after Corruption
rate 0.16
(0.606474820143885, 0.005035751691879349) (0.6617660212893179, 0.006224679925130481) (0.4556032171581769, 0.009527201112628678) (0.539627575376317, 0.008095167113643628)
after Corruption
rate 0.18
(0.5973802090403149, 0.0063149084176039325) (0.6543180337844137, 0.010386362555464632) (0.434343163538874, 0.00563315373397456) (0.5220881338458825, 0.006725765682797849)
after Corruption
rate 0.2
(0.5882991719831682, 0.006204987485668144) (0.6464294679526942, 0.008353531783268723) (0.4123592493297587, 0.010603513720970738) (0.5034802804372933, 0.009886232842209526)

"""

"""
ipheaders
after Corruption
rate 0.02
(0.9444729136163982, 0.0029330579249730033) (0.9666850026291905, 0.0027022488851779695) (0.9212672978878368, 0.0050297120671870515) (0.9434219184817, 0.0030920222940987434)
after Corruption
rate 0.04
(0.9144948755490482, 0.0033674963396779097) (0.9611553201329107, 0.0020333693045490983) (0.8648215586307357, 0.0072847777130662945) (0.91042795827638, 0.0038585196104953096)
after Corruption
rate 0.06
(0.8788067349926794, 0.004534812635298227) (0.9539197302402986, 0.0032255726737142037) (0.7973780043699928, 0.009066491664731492) (0.8686219156648954, 0.005487502673885141)
after Corruption
rate 0.08
(0.8514275256222547, 0.004011185321866204) (0.9502022422258634, 0.0034508532399177925) (0.7433357611070648, 0.007777823204202488) (0.834109930023547, 0.005106262707107694)
after Corruption
rate 0.1
(0.8293923865300146, 0.005652679885114417) (0.9414353593638778, 0.0036377148316408415) (0.7043699927166789, 0.012621178173661825) (0.8057533541088878, 0.007965549969241339)
after Corruption
rate 0.12
(0.8035139092240119, 0.006923332601778546) (0.9362937231497653, 0.009483759631527203) (0.6535324107793153, 0.010438551880975283) (0.769720861631916, 0.008820566242465784)
after Corruption
rate 0.14
(0.7773060029282577, 0.006588986484926671) (0.9245718084067731, 0.005653478135600721) (0.6063364894391842, 0.01164078897196109) (0.7323258762021717, 0.00953031656485432)
after Corruption
rate 0.16
(0.7579428989751098, 0.0036163167369787368) (0.919045775381044, 0.004972259830018612) (0.5684632192279679, 0.008438914949931885) (0.7023899633831733, 0.0060816661229274515)
after Corruption
rate 0.18
(0.7353587115666178, 0.005441460009999444) (0.910727764134611, 0.007325421115460451) (0.5249089584850692, 0.010997815003641661) (0.6658957292589565, 0.009043705851586096)
after Corruption
rate 0.2
(0.7137262079062958, 0.004194064731889728) (0.9005814420885322, 0.009975642473579323) (0.4839038601602331, 0.009613983976693375) (0.629441397305444, 0.0076012775654752925)
"""
