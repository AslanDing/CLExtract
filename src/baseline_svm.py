import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.pipeline import make_pipeline
from sklearn.preprocessing import StandardScaler
from sklearn.svm import SVC
from sklearn.metrics import accuracy_score,confusion_matrix
import random
import matplotlib.pyplot as plt
from util.tools import np_bit_loss,npflip,np_bit_aug
from data.loadData import loadData
from util.tools import accConfusion,binariz

names = ['bbheader_gseheader']
# names = ['gseheader']
# names = ['ipheaders']

name = names[0]

X,y,_ = loadData(name)
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=42)
svm = SVC(gamma='auto')
svm.fit(X_train, y_train)
y_pred_test = svm.predict(X_test)
acc, tn, fp, fn, tp = accConfusion(y_test, y_pred_test)
print('ACC',acc)
print('TN',tn,'FP',fp,'FN',fn, 'TP',tp)

for percentage in range(2,22,2):
    # if percentage<20:
    #     continue
    rate = percentage/100
    accs= []
    pres= []
    recalls= []
    f1s = []
    for i in range(10):
        X_test_crpt = np.array([np_bit_aug(x,rate) for x in X_test])
        y_pred_test_crpt = svm.predict(X_test_crpt)
        acc, tn, fp, fn, tp = accConfusion(y_test, y_pred_test_crpt)
        pre = tp/(tp+fp)
        rec = tp/(tp+fn)
        accs.append(acc)
        pres.append(pre)
        recalls.append(rec)
        f1s.append(2*pre*rec/(pre+rec))

    print('after Corruption')
    print('rate',rate)
    print((np.mean(accs), np.std(accs)),
          (np.mean(pres), np.std(pres)),
          (np.mean(recalls), np.std(recalls)),
          (np.mean(f1s), np.std(f1s)))
"""
bbheader_gseheader
after Corruption
rate 0.0
(0.9747666781887313, 1.1102230246251565e-16) (0.954486345903771, 1.1102230246251565e-16) (0.9979605710401088, 0.0) (0.9757394483217017, 1.1102230246251565e-16)
after Corruption
rate 0.02
(0.9715174559281025, 0.001435225682131133) (0.954206703523608, 0.0012638197394708496) (0.9915703602991164, 0.001854273514206082) (0.9725292498041679, 0.0013920361942093432)
after Corruption
rate 0.04
(0.9641548565502938, 0.003156898559506924) (0.9536852654958041, 0.003096070316750184) (0.9769544527532293, 0.004534386443413276) (0.9651741705302557, 0.003100767429360467)
after Corruption
rate 0.06
(0.9568959557552713, 0.0021809597724642025) (0.953460102472835, 0.0029051787455840862) (0.9622025832766825, 0.002739556992469063) (0.9578077812377339, 0.0021254347937160315)
after Corruption
rate 0.08
(0.9446940891807811, 0.002791099790969423) (0.9492241841747363, 0.0027199188180432256) (0.9416043507817811, 0.004441712093519944) (0.9453928924591842, 0.0028183074526766066)
after Corruption
rate 0.1
(0.9336329070169376, 0.00436411036352204) (0.9506171256221236, 0.0036041246210876477) (0.9171312032630864, 0.007895455763192312) (0.9335545878386313, 0.004565672303497396)
after Corruption
rate 0.12
(0.9204977531973733, 0.004429331069378866) (0.947433209588233, 0.0032931636048573274) (0.8932019034670293, 0.007229352966740543) (0.9195062153908454, 0.004696411370483091)
after Corruption
rate 0.14
(0.90636017974421, 0.00425725870345934) (0.9452647969246855, 0.0041969725601078344) (0.8660095173351461, 0.008416746351132313) (0.90387446969448, 0.00473251632393849)
after Corruption
rate 0.16
(0.8866920152091253, 0.005677280378195045) (0.9407286268801667, 0.0047406449319251625) (0.8294357579877634, 0.01057732265585533) (0.8815444001885728, 0.006487425970514015)
after Corruption
rate 0.18
(0.8725544417559628, 0.004084226603774971) (0.9419566691965148, 0.002624391426890398) (0.7985723997280761, 0.00853452218761377) (0.864330568006365, 0.004957519855064543)
after Corruption
rate 0.2
(0.8554096094020046, 0.008552671193607296) (0.9370917084897336, 0.006918521604145763) (0.7670972127804214, 0.012210865054693524) (0.843592632646281, 0.009805422246904722)

"""
"""
gseheader
rate 0.0
(0.7579747522736529, 1.1102230246251565e-16) (0.8395535402860134, 1.1102230246251565e-16) (0.6453083109919572, 1.1102230246251565e-16) (0.7297256328634226, 1.1102230246251565e-16)
after Corruption
rate 0.02
(0.7526265779828967, 0.0012189463456301734) (0.8362751417184343, 0.0018829106890449357) (0.6359249329758714, 0.0019480860187222392) (0.7224649298649093, 0.001484748599021721)
after Corruption
rate 0.04
(0.7457988326320075, 0.0018877687503460023) (0.8324793911488315, 0.002072470990844219) (0.6233780160857909, 0.002864495525832305) (0.7129100004569371, 0.0024130380012711405)
after Corruption
rate 0.06
(0.7381430704493009, 0.0015169566248425586) (0.8268609408791738, 0.0024679780275783073) (0.6106970509383378, 0.002455535772662813) (0.7025227008679611, 0.0018825089674917572)
after Corruption
rate 0.08
(0.7318718610017647, 0.0031414754385443097) (0.8243274887773844, 0.005254136199516027) (0.5978552278820375, 0.003026048484616087) (0.6930538117788245, 0.003392315506842354)
after Corruption
rate 0.1
(0.7217999185557213, 0.0028422964154155533) (0.8180122522496214, 0.0033904300361839814) (0.5794638069705094, 0.005989062522442124) (0.6783580658549009, 0.004318308345984588)
after Corruption
rate 0.12
(0.7124066784308403, 0.0035918937749436757) (0.8145896210577556, 0.004393323786803885) (0.5592761394101877, 0.004894432121374331) (0.6632047645097142, 0.00468482338347534)
after Corruption
rate 0.14
(0.7028505497488802, 0.0036832719121794926) (0.8085438667663751, 0.005151791563915827) (0.5412868632707774, 0.005275441877211306) (0.6484470809369915, 0.004887285844159771)
after Corruption
rate 0.16
(0.6909868331749695, 0.0034249931075193136) (0.8011456402963464, 0.004755267121973571) (0.5183378016085791, 0.005060139726500386) (0.6294244992267479, 0.004731555844894821)
after Corruption
rate 0.18
(0.6836025519207276, 0.0021866015074208157) (0.7989716577890618, 0.0028545850044402583) (0.5012064343163539, 0.004439811035302742) (0.6159803883769441, 0.003597946482708788)
rate 0.2
(0.6718474277182028, 0.0035724507428145343) (0.7917485340198602, 0.0059784178611170065) (0.4774798927613941, 0.005014193282898034) (0.5956933575321655, 0.004910231194469124)
"""
"""
ipheader
rate 0.02
(0.9661420204978037, 0.0005729310337664275) (0.9611104634226967, 0.0010147762497320324) (0.9719592134013109, 0.0008770280101086686) (0.9665037886398844, 0.0005615814723385735)
after Corruption
rate 0.04
(0.9669106881405563, 0.0010117331596694878) (0.9638366599436278, 0.0010057310028605995) (0.9705753823743628, 0.0013508548427524651) (0.9671938739820988, 0.0010086745970906805)
after Corruption
rate 0.06
(0.9667642752562224, 0.0011078144912460906) (0.9658508669949992, 0.0015583494121689234) (0.9680990531682447, 0.0017780853045497064) (0.966972026374848, 0.0011060075844427546)
after Corruption
rate 0.08
(0.9676061493411421, 0.0013914039391470184) (0.969039481284128, 0.002182592959612796) (0.9664238892935177, 0.0011492886990574756) (0.9677287032060564, 0.001364064363560771)
after Corruption
rate 0.1
(0.9666910688140555, 0.001570103264240652) (0.9727868931933699, 0.0015390292503240032) (0.9605972323379459, 0.003080595190467102) (0.966650119497991, 0.0016084379363213194)
after Corruption
rate 0.12
(0.9639458272327965, 0.0016713689687892933) (0.9751713328448475, 0.0015364995777633259) (0.9525127458120902, 0.002779138241564301) (0.9637065818426264, 0.0017117914715052045)
after Corruption
rate 0.14
(0.9573572474377746, 0.0032378854342888373) (0.9785203462178865, 0.0015914103127827744) (0.9356882738528769, 0.005926404039748979) (0.9566163927285448, 0.003405745797101958)
after Corruption
rate 0.16
(0.9469985358711567, 0.004038979275002568) (0.9800617885142937, 0.0027171125541410974) (0.9131099781500364, 0.006333139900459833) (0.9453943401475232, 0.004279567410321862)
after Corruption
rate 0.18
(0.928221083455344, 0.004060978505786524) (0.9817460974695369, 0.002166985278503847) (0.8734158776402039, 0.00773405037288175) (0.9243999993762883, 0.004565645722622112)
after Corruption
rate 0.2
(0.9072108345534406, 0.005357716386641473) (0.9855266112565626, 0.0027930672109108684) (0.8275309541150765, 0.010797017019785247) (0.8996031586890076, 0.006357507468900446)
"""